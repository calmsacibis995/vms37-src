;
;	MCR Command language interpreter structure definitions
;
; IDENT	V02-002
;

;
;****************************************************************************
;*									    *
;*  COPYRIGHT (c) 1978, 1980, 1982 BY					    *
;*  DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS.		    *
;*  ALL RIGHTS RESERVED.						    *
;* 									    *
;*  THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED   *
;*  ONLY IN  ACCORDANCE WITH  THE  TERMS  OF  SUCH  LICENSE  AND WITH THE   *
;*  INCLUSION OF THE ABOVE COPYRIGHT NOTICE. THIS SOFTWARE OR  ANY  OTHER   *
;*  COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY   *
;*  OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE IS  HEREBY   *
;*  TRANSFERRED.							    *
;* 									    *
;*  THE INFORMATION IN THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT NOTICE   *
;*  AND  SHOULD  NOT  BE  CONSTRUED AS  A COMMITMENT BY DIGITAL EQUIPMENT   *
;*  CORPORATION.							    *
;* 									    *
;*  DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY OF ITS   *
;*  SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.		    *
;* 									    *
;*									    *
;****************************************************************************
;

;++
; FACILITY:  MCR Command language interpreter
;
; ABSTRACT:
;
;	These are the structure definitions used by the MCR
;	command interpreter.
;
; ENVIRONMENT:
;
;	VAX/VMS operating system. supervisor mode.
;
; AUTHOR:  Tim Halvorsen, Feb 1980
;
; Modified by:
;
;	V002	MAJ0002		Melanie Johnson		18-Nov-81
;		Eliminate CMD stucture and use the CMD structure from
;		CLIDEF instead.  Add some new definitions to WRK.
;
;	V001	MAJ0001		Melanie Johnson		04-Aug-81
;		Put FILSPC and FILERR into the PRC data structure
;		and remove them from the WRK data structure so they will
;		not be re-intialized on every command.
;
;--


;
;	DEFINE RESULT PARSE POINTERS.  EACH POINTER DESCRIBES
;	A TOKEN ON THE COMMAND LINE FROM LEFT TO RIGHT.
;

	STRUCT	PTR
	F	DESCR,L		; EACH POINTER IS 1 LONGWORD
	S	VALUE,0,B	; LOW BYTE IS VALUE (QUALIFIER #, ETC)
	V	<
		VALUE,8		; ITEM VALUE
		OFFSET,12	; ITEM OFFSET IN BUFFER
		FLAGS,4		; ITEM FLAGS
		TERM,4		; ITEM TERMINATOR CLASS NUMBER
		TYPE,4		; ITEM TYPE
		>
	V	<		; FLAG BIT DEFINITIONS FOR QUALIFIERS
		,20
		NEGATE		; QUALIFIER WAS NEGATED
		EQUAL		; INPUT/OUTPUT TERMINATOR
		>
	C	<,_K_,1		; DEFINE TERMINATOR CLASSES, STARTING AT 1
		BLANK		; BLANK
		COLON		; COLON
		SLASH		; SLASH
		PLUS		; PLUS SIGN
		COMMA		; COMMA
		RPAREN		; RIGHT PARENTHESIS
		LPAREN		; LEFT PARENTHESIS
		>
	C	<,_K_,0		; DEFINE TYPE NUMBERS, STARTING AT 0
		COMDQUAL	; COMMAND QUALIFIER
		PARMQUAL	; PARAMETER QUALIFIER
		QUALVALU	; QUALIFIER VALUE
		PARAMETR	; PARAMETER
		ENDLINE		; END OF LINE
		>
	L	LENGTH		; FIXED LENGTH OF DESCRIPTOR
	E

;
;	DEFINE PARAMETER LIST MARKER.  EACH MARKER DESCRIBES
;	THE STARTING THRU ENDING POINTERS WHICH DESCRIBE A
;	GIVEN PARAMETER (INCLUDING QUALIFIERS AND VALUES).
;

	STRUCT	PLM
	F	NXTDESC,B	; NEXT DESCRIPTOR TO BE EXAMINED IN CURRENT LIST
	F	FSTDESC,B	; FIRST DESCRIPTOR IN LIST
	F	LSTDESC,B	; LAST DESCRIPTOR IN LIST
	F	TRMDESC,B	; TERMINATOR DESCRIPTOR
	L	SIZE		; SIZE OF EACH ENTRY
	E

;
;	DEFINE PROCESS WORK AREA (BASED AT CTL$AG_CLIDATA)
;

	STRUCT	PRC
	F	SAVAP		; SAVED ARGUMENT POINTER
	F	SAVFP		; SAVED FRAME POINTER
	F	INPRAB		; ADDRESS OF INPUT RAB
	F	OUTRAB		; ADDRESS OF OUTPUT RAB
	F	ERRRAB		; ADDRESS OF ERROR RAB
	F	INDINPRAB	; ADDRESS OF INDIRECT INPUT RAB
	F	INDOUTRAB	; ADDRESS OF INDIRECT OUTPUT RAB
	F	INDFAB		; ADDRESS OF INDIRECT FAB
	F	ALLOCREG,Q	; SYMBOL ALLOCATION REGION LISTHEAD
	F	GLOBAL,Q	; GLOBAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	SEVERITY	; ADDRESS OF ERROR SEVERITY SYMBOL VALUE
	F	STATUS		; ADDRESS OF COMPLETION STATUS VALUE
	F	FILSPC		; POINTER TO FILESPEC
	F	FILERR		; FILE ERROR VALUE
	F	INDEPTH		; INDIRECT DEPTH CHANGE INDICATOR
	F	SYMBOL		; ADDRESS OF GOTO LABEL TABLE ENTRY
	F	INPCHAN,W	; INPUT CHANNEL FOR INTERACTIVE JOBS
	F	CLIFLAG,W	; CLI SPECIFIC FLAGS
	S	ERRIFI,0,W	; DCL: 'ERROR' RMS IFI NUMBER
	F	FLAGS,W		; PROCESS LEVEL FLAGS
	V	<M
		GOEOF		; ONE EOF ENCOUNTERED IN GOTO SEARCH
		CNTRLY		; SUPERVISOR CONTROL Y/C LEVEL REQUEST
		DISABL		; DISABLE CONTROL Y AST'S
		EXIT		; EXIT HANDLER ESTABLISHED
		GOTO		; FORWARD GOTO IN PROGRESS
		IND		; PROCESSING INDIRECT FILE
		MODE		; COMMAND PROCESSING MODE (BATCH=1, INTER=0)
		VERIFY		; VERIFY LINES OF INDIRECT COMMAND FILES
		USRDET		; PROCESS IS USER DETACHED
		DBGQUAL		; DEBUG QUALIFIER SEEN ON COMMAND
		DBGTRUE		; STATE OF DEBUG WAS TRUE
		YLEVEL		; RUNNING AT CONTROL Y LEVEL
		HANGUP		; TERMINAL HANGUP PENDING
		PAUSE		; CLI PAUSE STATE ACTIVE
		NOCTLY		; NO CONTROL/Y INTERRUPTS ALLOWED
		>
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON CONDITION COMMAND TEXT
	F	CLIWRK0		; CLI DEPENDANT WORK LOCATIONS
	F	CLIWRK1
	F	CLIWRK2
	F	CLIWRK3
	F	CLIWRK4
	F	TAB_VEC		; ADDRESS OF COMMAND TABLE VECTOR
	F	EXTBLK		; EXIT HANDLER CONTROL BLOCK
	F	EXTHND		; EXIT HANDLER ADDRESS
	F	EXTARG		; NUMBER OF EXIT HANDLER ARGUMENTS
	F	EXTPRM		; ADDRESS OF REASON FOR EXIT (BELOW)
	F	EXTCOD		; REASON FOR EXIT
	F	STACKPT		; INDIRECT STACK POINTER
	F	STACKLM		; INDIRECT STACK LIMIT
	F	EXMDEPADR	; "DOT" FOR EXAMINE/DEPOSIT
	F	EXMDEPWID,B	; WIDTH DEFAULT, IE: BYTE,WORD,LONGWORD
	F	EXMDEPMOD,B	; MODE DEFAULT, IE: ASCII,HEX,OCTAL
	F	DEFRADIX,B	; CURRENT DEFAULT RADIX
	C	<,_K_		; PROCESS RADIX TYPES
		HEX		; HEXIDECIMAL
		DEC		; DECIMAL
		OCT		; OCTAL
		>
	F	FLAGS2,B	; PROCESS LEVEL FLAGS (MORE OF THEM)
	V	<M
		CMD		; COMMAND CALLBACK HAS BEEN DONE
		CHAIN		; CHAIN CALLBACK HAS BEEN DONE
		RUNDEF		; USE RUN DEFAULT (NOT EXTERNAL)
		EXEONLY		; IMAGE IS EXECUTE ONLY
		PRIV		; IMAGE IS PRIVILEGED
		>
	F	LSTSTATUS	; LAST STATUS SET (LONGWORD VALUE)
	F	PROCUIC		; ORIGINAL PROCESS UIC
	F	ONCTLY		; ADDRESS OF ON CONTROL/Y COMMAND TEXT
	F	IDFLNK		; POINTER TO INDIRECT FILE FRAMES
	F	SUBLNK		; POINTER TO CURRENT SUBROUTINE FRAMES
	F	BLKLNK		; POINTER TO CURRENT BLOCK FRAMES
	F	BEGINRFA,W,3	; CURRENT BLOCK BEGIN POSITION
	F	NESTLEVEL,B	; CURRENT BLOCK NESTING LEVEL
	F	FWDSCAN,B	; TYPE OF FORWARD SCAN
	C	<,_K_		; FORWARD SCAN TYPES
		GOTO		; GOTO A LABEL
		GOSUB		; GOSUB TO A LABEL
		EXIT		; EXIT FOM A BEGIN-END BLOCK
		>
	F	IMAGENAME,Q	; DESCRIPTOR OF CHAIN IMAGE FILE SPECIFICATION
	F	COMMAND,Q	; DESCRIPTOR OF CHAIN COMMAND LINE FOR LATER
	L	LENGTH		; LENGTH OF PROCESS WORK AREA
	E

;
;	DEFINE PROCESS LEVEL FLAGS (PRC_W_CLIFLAG)
;

	STRUCT	MCR
	V	<M
		RAD50		; LAST STRING WAS ONLY RAD50
		ALPHAN		; LAST STRING WAS ONLY ALPHA/NUMERIC
		ESCAPE		; LAST ASK WAS ANSWERED WITH <ESC>
		DEFALT		; LAST NUMERIC RESPONSE WAS DEFAULTED
		EOF		; LAST .READ GOT AN END-OF-FILE
		OPNINP		; OPEN OF INPUT REQUIRED ON UNSTACK
		DELINP		; DELETE THE INPUT ON CLOSE
		DOLLARS		; DOLLAR SIGNS FOR COMMANDS
		ESCTRM		; ESCAPE TERMINATOR ALLOWED
		GLOBAL		; GLOBAL SYMBOLS
		LOWER		; LOWER CASE STRING ASSIGNMENT
		STRSUB		; STRING SUBSTITUTION
		QUIET		; QUIET COMMAND ECHO
		FORCMD		; PROCESSING FOREIGN COMMAND
		>
	E

;
;	DEFINE PROCESS RMS DATA AREA
;

	STRUCT	PRD
	F	FAB,G,80		; PROCESS FAB
	F	NAM,G,96		; PROCESS NAME BLOCK
	F	INPRAB,G,68		; INPUT RAB
	F	ALTINPRAB,G,68		; ALTERNATE INPUT RAB
	F	ALTOUTRAB,G,68		; ALTERNATE OUTPUT RAB
	F	OUTRAB,G,68		; OUTPUT RAB
	L	LENGTH			; NORMAL LENGTH
	F	OUTFID,W,3		; FILE ID FOR OUTPUT FILE
	F	OUTDID,W,3		; DIRECTORY ID FOR OUTPUT FILE
	F	OUTFNM,T,20		; OUTPUT FILE NAME
	L	XLENGTH			; LENGTH OF EXTENDED BLOCK
	E

;
;	DEFINE COMMAND WORK AREA (BASED AT FP)
;

	STRUCT	WRK
	C	<
		CMDBUFSIZ,508	; EXPANDED COMMAND BUFFER SIZE IN BYTES
		INPBUFSIZ,132	; INPUT BUFFER SIZE IN BYTES
		MSGBUFSIZ,132	; OUTPUT MESSAGE BUFFER SIZE IN BYTES
		RSLBUFSIZ,96*4	; RESULT PARSE BUFFER SIZE IN BYTES (96 MAX)
		DATETIME,11	; SIZE OF DATETIME BUFFER
		>
	-F	,B,0		; ENDING ADDRESS OF NEGATED STRUCTURE
				; (NEEDED TO OBTAIN LENGTH DEFINITION)
	L	LENGTH		; LENGTH OF COMMAND PARSING WORK AREA
	-F	MARKPTR,L	; POINTER INTO COMMAND BUFFER OF THE CURRENT
				; SEGMENT BEING PARSED
	-F	RESULT,G,380	; RESULT PARSE DESCRIPTOR AREA (96 MAX)
	-F	RSLNXT,L	; ADDRESS OF NEXT FREE TOKEN DESCRIPTOR
	-F	BUFFER,G,508	; COMMAND EXPANSION BUFFER
	S	RECORD,255,G	; INPUT RECORD BUFFER FOR FILE I/O COMMANDS
	-F	,B,4		; 4 BYTES BEFORE INPUT BUFFER FOR SLOPUNDER
	-F	INPBUF,G,132	; COMMAND INPUT BUFFER FOLLOWS EXPANSION BUFFER
	-F	SCANLEVEL,B	; NESTING LEVEL DURING FORWARD SCAN
	-F	DATETIME,T,11	; <DATE> OR <TIME> BUFFER
	-F	VERBTYP,B	; COMMAND VERB TYPE (SEE $CLIVERBDEF)
	-F	CMDOPT,B	; QUALIFIER # CAUSING THE FIRST SYNTAX CHANGE
	-F	CMDFLG,B	; COMMAND SPECIFIC FLAGS
	-F	CURADX,B	; CURRENT CONVERSION RADIX
	-F	PARMCNT		; COUNT OF PARAMETERS SEEN
	-F	MAXPARM		; MAXIMUM NUMBER OF PARAMETERS REQUIRED
	-F	MINPARM		; MINIMUM NUMBER OF PARAMETERS REQUIRED
	-F	SAVSP		; SAVED STACK POINTER
	-F	SAVAP		; SAVED ARGUMENT POINTER
	-F	SAVFP		; SAVED INITIAL FRAME POINTER
	-F	IOSB,Q		; I/O STATUS BLOCK
	-F	QUABLK		; ADDRESS OF QUALIFIER DESCRIPTORS
	-F	IMAGE		; ADDRESS OF IMAGE NAME STRING; OR TABLE INDEX
	-F	PAROUT		; ADDRESS OF LISTS OF OUTPUTS
	-F	PROMPT		; ADDRESS OF CURRENT PROMPT STRING
	-F	PROPTR		; ADDRESS OF PROMPT DESCRIPTORS
	-F	LOCFLG,W	; LOCAL FLAGS FOR COMMAND PROCESSING
	-F	FLAGS,W		; COMMAND LEVEL FLAGS
	V	<M
		ALL		; ALL QUALIFIERS ARE PRESENT ON COMMAND
		COMMAND		; COMMAND (IAMGE) EXECUTION IN PROGRESS
		IMCHNG		; IMAGE NAME CHANGE HAS BEEN DONE
		EQUAL		; EQUAL SIGN SEEN (INPUT/OUTPUT DELIMITER)
		QUAL		; PROCESSING QUALIFIER
		QUOTE		; PROCESSING QUOTED STRING
		STAR		; ASTERISK IS TERMINATOR
		VERB		; PROCESSING VERB
		ASK		; .ASK READ REQUIRED
		TRAILSPC	; TRAILING SPACES IN CONTINUED LINE
		NOCONT		; SUPPRESS CONTINUATION LINES
		FPROC		; FILE PROCESS, 0=OPEN, 1=CREATE
		FACCESS		; FILE ACCESS, 0=GET, 1=PUT
		FTEST		; FILE TEST, 0=NO, 1=YES
		ONERR		; .ONERR ACTIVE
		TABS		; DONT CONVERT TABS TO SPACES
		>
	-F	CHARPTR		; INPUT BUFFER CHARACTER POINTER
	E

;
;	DEFINE FORMAT OF THE RESULT PARSE WORK AREA SUPPLIED TO
;	RESULT PARSING ROUTINES BY THE CALLER.
;

	STRUCT	RPW
	F	USERCTX		; USER CONTEXT LONGWORD
	F	MCRWRK		; ADDRESS OF COMMAND WORK AREA
	F	STRPARM,B	; INDEX TO FIRST PARAMETER DESCRIPTOR
	F	LSTDESC,B	; INDEX TO LAST PARAMETER DESCRIPTOR
	F	,B,2		; SPARE
	F	,L,5		; SPARE
	F	BITS,G,32	; 256 BITS, 1 IF PLM PROCESSED BY RESULT PARSE
	L	HDRSIZ		; SIZE OF FIXED PORTION
	F	PRMLIM,G,64	; UP TO 16 PARAMETER LIMIT DESCRIPTORS (PLM)
	L	LENGTH		; LENGTH OF MAXIMUM SIZE
	E

;
;	DEFINE SYMBOL TABLE ENTRY
;

	STRUCT	SYM
	F	FL		; SYMBOL ENTRY FORWARD LINK
	F	BL		; SYMBOL ENTRY BACKWARD LINK
	F	SIZE,W		; SIZE OF SYMBOL TABLE ENTRY
	F	TYPE,B		; TYPE OF SYMBOL TABLE ENTRY
	C	<,_K_
		STRING		; STRING VALUE
		PERM		; PERMANENT SYMBOL
		LOGICAL		; LOGICAL TRUE/FALSE
		OCTAL		; OCTAL NUMERIC
		DECIMAL		; DECIMAL NUMERIC
		HEXDEC		; HEXADECIMAL NUMERIC
		>
	F	NESTLEVEL,B	; NESTING LEVEL AT WHICH SYMBOL DEFINED
	F	SYMBOL,T	; ASCIC SYMBOL NAME
				; ASCIC VALUE OF SYMBOL FOLLOWS
	E

;
;	DEFINE INDIRECT STACK FRAME
;

	STRUCT	IDF
	F	LNK		; POINTER TO NEXT INDIRECT FILE FRAME
	F	INPIFI,W	; IFI FOR INPUT
	F	OUTIFI,W	; IFI FOR OUTPUT
	F	OUTISI,W	; ISI FOR OUTPUT
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON ERROR COMMAND TEXT
	F	INPRABCTX	; CONTENTS OF INPUT RAB CTX LONGWORD
	F	OUTRABCTX	; CONTENTS OF OUTPUT RAB CTX LONGWORD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
	F	OUTDVI,T,16	; INDIRECT OUTPUT DEVICE (ASCIC)
	F	INPDVI,T,16	; INDIRECT INPUT DEVICE (ASCIC)
	F	INPFID,W,3	; FILE ID FOR INPUT FILE
	F	INPDID,W,3	; DIRECTORY ID FOR INPUT FILE
	F	INPRFA,W,3	; RECORD FILE ADDRESS FOR INPUT
	F	FLAG,W		; INDIRECT FLAGS
	V	<
		INPOPN		; THIS INPUT OPEN IS REQUIRED
		>
	F	ONCTLY		; SAVED ADDRESS OF ON CONTROL/Y COMMAND
	F	SUBLNK		; SAVED SUBROUTINE LIST POINTER
	F	BLKLNK		; SAVED BLOCK LIST POINTER
	F	BEGINRFA,W,3	; POSITION OF BEGINNING OF CURRENT BLOCK
	F	NESTLEVEL,B	; SAVED NESTING LEVEL
	F	,B		; SPARE BYTE
	L	LENGTH		; LENGTH OF INDIRECT FRAME
	E

;
;	DEFINE SUBROUTINE (GOSUB/RETURN) STACK FRAME
;

	STRUCT	SUB
	F	LNK		; POINTER TO NEXT SUBROUTINE FRAME
	F	BLKLNK		; SAVED BLOCK FRAME POINTER
	F	RFA,W,3		; RECORD FILE ADDRESS TO RETURN TO
	L	BLN		; LENGTH OF FRAME
	E

;
;	DEFINE BLOCK (BEGIN/END) STACK FRAME
;

	STRUCT	BLK
	F	LNK		; POINTER TO NEXT BLOCK FRAME
	F	BEGINRFA,W,3	; SAVED BEGIN RFA
	L	BLN		; LENGTH OF FRAME
	E
