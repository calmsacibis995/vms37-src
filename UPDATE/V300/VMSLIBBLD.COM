$ !
$ !	[ VMSLIB.COM ] V M S L I B B L D . C O M
$ !
$ ! This file builds:
$ !			LIB.MLB
$ !			LIB.L32
$ !			STARLET.MLB
$ !			STARLET.L32
$ !			STARLET.OLB
$ !			SYSBLDLIB.OLB
$ !			SCRSHR.EXE
$ !
$ !	Assumes definitions for  EXE$:, OBJ$:, LIS$:, MAP$:, COM$:
$ !
$ GOTO 'PHASE'
$
$INIT:
$ !
$ !	Create the Directories
$ !
$ @SYSBLDCOM$:CREATEDIR
$ EXIT
$
$UPDATE:
$ !
$ !	Create updated macro library sources.
$ !
$ DELSHRLIB SRC$:UTLDEFB.B32
$ DELSHRLIB SRC$:OPCDEF.MDL
$ @COM$:VMSLIBUPD
$ COPY SRC$:STARDEF%%.MDL SRC$:STARDEF.MDL ! Create STARDEF.MDL from pieces
$ CPYSHRLIB SRC$:UTLDEFB.B32		! Share file with LINKER component
$ CPYSHRLIB SRC$:OPCDEF.MDL		! Share file with MSGFIL component
$ EXIT
$
$SRCLIB:
$ !
$ !	Create the macro libraries
$ !
$ SET WORKING_SET/LIMIT=700/QUOTA=700
$ !
$ ! Create the BLISS system service macro require file
$ !
$ DELETE SRC$:STARLE.REQ;*
$ RUN MARBLI
SRC$:STARLET.MAR
SRC$:STARLE.REQ
$ DELSHRLIB LIB$:F11DEF.B32
$ @COM$:VMSLIBMDL
$ CPYSHRLIB LIB$:F11DEF.B32		! Share file with DIR component
$ !
$ ! Edit the object format definition file to
$ !  enclose all the object language in one
$ !  macro.
$ !
$ EDIT /SOS /STEP:10 LIB$:OBJFMT.MAR
i1;1
	.MACRO	$OBJDEF, $GBL
	$DEFINI	OBJ, $GBL
i*/*
	$OBJRECDEF
	$MHDDEF
	$EOMDEF
	$EOMWDEF
	$GSDDEF
	$GPSDEF
	$SGPSDEF
	$GSYDEF
	$SRFDEF
	$SDFDEF
	$EPMDEF
	$PRODEF
	$FMLDEF
	$ARGDEF
	$SDFWDEF
	$EPMWDEF
	$PROWDEF
	$IDCDEF
	$ENVDEF
	$LSYDEF
	$LSRFDEF
	$LSDFDEF
	$LEPMDEF
	$LPRODEF
	$TIRDEF
	$DEFEND	OBJ, $GBL, DEF
	.ENDM	$OBJDEF
EBS
$ @COM$:VMSMLB
$ @COM$:SYSMLB
$ !
$ !	Copy the library, STARLET.MLB, to SYS$LIBRARY for other's use.
$ !
$ LIBRARY/COMPRES=(BLOCKS=412,MODU=170)/OUT=OBJ$:STARLET.MLB OBJ$:STARLET.MLB
$ PURGE OBJ$:STARLET.MLB
$ CPYSYSLIB OBJ$:STARLET.MLB,STARLET.L32,LIB.L32,TPAMAC.L32
$ CPYSYSLIB OBJ$:CLIMAC.L32
$ EXIT
$
$ASSEM:
$ !
$ !	Delete and re-create the assembly language objects and listings
$ !
$ DELETE OBJ$:*.OBJ;*,LIS$:*.LIS;*
$ @SYSBLDCOM$:FASM 'FACNAM "" N 'UPDATES
$ CPYRESOBJ OBJ$:SCRPKG.OBJ	! Share with those who need it
$ EXIT
$
$OBJLIB:
$ !
$ !	Create the object library STARLET.OLB
$ !
$ DELETE SYS$LIBRARY:STARLET.OLB;*
$ LIB/CREATE=(BLOCKS=1899,GLOBALS=4300,MODULES=350) SYS$LIBRARY:STARLET
$ LIB SYS$LIBRARY:STARLET OBJ$:TPARSE,CVTATB,LIBCLICAL
$ LIB SYS$LIBRARY:STARLET OBJD$:[CLE.OBJ]CLINT.OBB
$ LIB SYS$LIBRARY:STARLET /SELECTIVE_SEARCH -
	OBJD$:[SYS.OBJ]P1SYSVECT.OBB,USRVECTOR,IODEF.OBB,MISCDEF.OBB,PRDEF.OBB,SSDEF.OBB
$ LIB SYS$LIBRARY:STARLET OBJD$:[SYS.OBJ]SYSVECTOR.OBB/NOGLOBALS
$ LIB SYS$LIBRARY:STARLET /SELECTIVE_SEARCH -
	OBJD$:[DCL.OBJ]CLIGBL.STB,CLISYM1.STB
$ LIB SYS$LIBRARY:STARLET /SELECTIVE_SEARCH OBJ$:CLISYM2 !*TMP TILL PRODUCTS FIXED
$ LIB SYS$LIBRARY:STARLET OBJD$:[RMS.OBJ]RMSGBL.OBB/SELECTIVE_SEARCH
$ LIB/EXTRACT=*/OUTPUT=OBJ$:RTL.OBJ OBJD$:[RTL.OBJ]RTL.OLB
$ LIB/CREATE OBJ$:TEMPRTL OBJ$:RTL
$ LIB/EXT=%%%$MSGDEF/OUT=OBJ$:RTLMSGDEF OBJ$:TEMPRTL
$ LIB/DEL=%%%$MSGDEF OBJ$:TEMPRTL
$ LIB/EXTRACT=*/OUT=OBJ$:RTL OBJ$:TEMPRTL
$ LIB SYS$LIBRARY:STARLET OBJ$:RTL
$ LIB SYS$LIBRARY:STARLET OBJ$:RTLMSGDEF/SELECTIVE_SEARCH
$ DELETE OBJ$:RTL.OBJ;*,OBJ$:RTLMSGDEF.OBJ;*,OBJ$:TEMPRTL.OLB;*
$ LIB SYS$LIBRARY:STARLET OBJD$:[PASCAL.OBJ]PASRTL.OBS
$ LIB SYS$LIBRARY:STARLET -
  OBJD$:[SORT32.OBJ]GENKEY,GHSIM,KEYSUB,MERGE,RMSIO,SCRIO,SPECPR,SORTSR,-
  STATS,SORMSG
$ LIB SYS$LIBRARY:STARLET OBJD$:[IOSUP.OBJ]LASWEEP,LABUFFER,LASNDLDRQ,DRSUP
$ LIB /COMPRES=(BLOCK=1899,GLOB=4300,MODU=350)/OUT=SYS$LIBRARY:STARLET -
	SYS$LIBRARY:STARLET
$ !
$ !	Create the system-build library for global symbols available during
$ !	system build, but not for customer consumption
$ !
$ DELETE SYS$LIBRARY:SYSBLDLIB.OLB;*
$ LIB/CREATE SYS$LIBRARY:SYSBLDLIB OBJD$:[DCL.OBJ]CLISYM.STB/SELECTIVE_SEARCH
$ LIB SYS$LIBRARY:SYSBLDLIB OBJ$:LIBMERGE,CALLIMAGE,CREMAPSEC,SETPRIV
$ LIB SYS$LIBRARY:SYSBLDLIB OBJ$:LIBACP,LIBEXECLI,LIBASSIGN
$ LIB SYS$LIBRARY:SYSBLDLIB OBJ$:LIBCREDIR,LIBEXTCON,LIBFIDNAM,LIBFILPRO,LIBUNLFIL
$ !
$ !	Create the shareable image library IMAGELIB.OLB
$ !
$ LIBRARY /CREATE /SHARE SYS$LIBRARY:IMAGELIB
$ EXIT
$
$LNKLIB:
$ !
$ ! Build the shareable screen package SCRSHR
$ !
$ @COM$:LNKSCRSHR
$ CPYSYSLIB EXE$:SCRSHR.EXE
$ INSHARLIB EXE$:SCRSHR
$ EXIT
$
$LINK:
$ !
$ ! 	No EXE to produce.
$ !
$ EXIT
$
$RESULT:
$ SET NOON
$ !
$ ! Compress IMAGELIB.OLB
$ !
$ LIB/COMPR=(BLOCK=66,MODU=7,GLOB=800)/OUT=SYS$LIBRARY:IMAGELIB -
	SYS$LIBRARY:IMAGELIB
$ PURGE SYS$LIBRARY:IMAGELIB.OLB
$ CPYSYSLIB LIB$:STARLET.REQ,LIB,SRC$:TPAMAC,CLIMAC
$ CPYSYSLIB LIBD$:[SYS.OBJ]LIB.MLB
