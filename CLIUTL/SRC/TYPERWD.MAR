	.TITLE	TYPERWD - TYPE READ/WRITE DATA MODULE
	.IDENT	'V03-000'

;
;****************************************************************************
;*									    *
;*  COPYRIGHT (c) 1978, 1980, 1982 BY					    *
;*  DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS.		    *
;*  ALL RIGHTS RESERVED.						    *
;* 									    *
;*  THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED   *
;*  ONLY IN  ACCORDANCE WITH  THE  TERMS  OF  SUCH  LICENSE  AND WITH THE   *
;*  INCLUSION OF THE ABOVE COPYRIGHT NOTICE. THIS SOFTWARE OR  ANY  OTHER   *
;*  COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY   *
;*  OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE IS  HEREBY   *
;*  TRANSFERRED.							    *
;* 									    *
;*  THE INFORMATION IN THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT NOTICE   *
;*  AND  SHOULD  NOT  BE  CONSTRUED AS  A COMMITMENT BY DIGITAL EQUIPMENT   *
;*  CORPORATION.							    *
;* 									    *
;*  DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY OF ITS   *
;*  SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.		    *
;* 									    *
;*									    *
;****************************************************************************
;

;++
; FACILITY:	STARLET CLI UTILITY PROGRAM
;
; ABSTRACT:	READ/WRITE DATA FOR TYPE UTILITY
;
;
; ENVIRONMENT:	NATIVE/USER MODE CODE
;
; AUTHOR:	W.H.BROWN, CREATION DATE: 11-MAY-1977
;
; MODIFIED BY:
;
;	V001	TMH0001		Tim Halvorsen	29-Jun-1981
;		Open the input file for shared read/write access.
;--

	.SBTTL	DECLARATIONS
;
; INCLUDE FILES:
;

;
; MACROS:
;

;
; EQUATED SYMBOLS:
;
	$CLIDEF				; DEFINE CLI CODES AND VALUES
	LINBUFSIZ=512			; SIZE OF TYPE LINE BUFFER
	FILNAMSIZ=128

;
; OWN STORAGE:
;
;
	.PSECT	RWDATA	WRT,RD,BYTE
 
;
; DEFINE CALL BACK DATA STRUCTURES
;
TYP_CLIWRK::				; TYPE COMMAND LINE INTERFACE WORK AREA
	.LONG	TYP$CTXBLK		; SET USER CONTEX CELL WITH CONTEX BLK
	.BLKB	CLI$C_WORKAREA-4	; RESULT PARSE WORK AREA
TYP_BITMAP::				; RESULT PARSE FLAGS
	.BLKB	4			; BIT MASK AREA
DEFNAM:	.ASCII	/.LIS/			; INITIAL DEFAULT IS LISTING
EXPFNM:	.BLKB	FILNAMSIZ		; EXPANDED NAME
RSLFNM:	.BLKB	FILNAMSIZ		; RESULTANT NAME
OUTNAM:	.BLKB	FILNAMSIZ		; OUTPUT FILE NAME HERE
RHBUF:	.BLKB	20			; RECORD HEADER BUFFER
 
	TYPCTXBLK	ALLO=YES	; ALLOCATE THE CONTEXT BLOCK
 
TYP_INITPRS::				;
	$CLIREQDESC	-		; CALLBACK REQUEST DESCRIPTOR FOR INIT
		RQTYPE=CLI$K_INITPRS
TYP_GETCMD::				;
	$CLIREQDESC  CLI$K_GETCMD	; REQUEST FOR COMMAND DESCRIPTION
 
TYP_PARSDON::				;
	$CLIREQDESC	-		; REQUEST DESCRIPTOR FOR PARSE DONE
		RQTYPE=CLI$K_ENDPRM1,-	; COMPLETED WITH PARAMETER SET ONE
		ERRACT=TYP$CMDERR	; ERROR ACTION FOR COMMAND ERRORS
 
TYP_OUTDESC::				;
	$CLIREQDESC	-		; REQUEST DESCRIPTOR FOR OUTPUT FILE
		RQTYPE=CLI$K_OUTPUT1,-
		BITNUM=0,-		; GARBAGE BIT
		ERRACT=TYP$CMDERR,-	; ERROR ACTION FOR COMMAND ERRORS
		PRSACT=TYP_OUTPUT,-
 
TYP_INPDESC::				;
	$CLIREQDESC	-		; REQUEST DESCRIPTOR FOR INPUT FILE
		RQTYPE=CLI$K_INPUT1,-
		BITNUM=0,-
		ABSACT=TYP_DONE,-	; PALCE TO GO WHEN NO MORE INPUTS
		ERRACT=TYP$CMDERR	; ERROR ACTION FOR COMMAND ERRORS
 
 
TYP_LINDES::				; EXTERNAL NAME
LINDES: .WORD	0,LINBUFSIZ		; DESCRIPTOR FOR LINE BUFFER
	.LONG	LINBUF			; ADDRESS
LINBUF: .BLKB	LINBUFSIZ		; RECORD BUFFER
 
;
; RMS 32 DATA STRUCTURES
;
 
TYP_OUTFAB::				; EXTERNAL NAME
	$FAB	FAC=PUT,-		; OUTPUT FAB, ACCESS IS PUT
		ORG=SEQ,-		; SEQUENTIAL FILE
		NAM=TYP_OUTNAM,-	; ASSOCIATED NAME BLOCK
		FOP=<SUP,OFP,SQO>,-	; SUPERSEED IF NECESSARY,
				-	; OUTPUT FILE PARSE, AND
				-	; SEQUENTIAL OPERATION
		MRS=LINBUFSIZ,-		; MAXIMUM RECORD SIZE
		RAT=CR			; RECORD ATTRIBUTES IS CR/LF
 
TYP_OUTNAM::				; OUTPUT NAME BLOCK
	$NAM	RSA=OUTNAM,-		;
		RSS=FILNAMSIZ,-		;
		ESA=OUTNAM,-		; EXPANDED AND RESULT IN SAME PLACE
		ESS=FILNAMSIZ,-		;
		RLF=TYP_INPNAM		; RELATED TO INPUT FILE
 
TYP_OUTRAB::				;
	$RAB	RAC=SEQ,-		; RECORD ACCESS IS SEQENTIAL
		RHB=RHBUF,-		; RECORD HEADER BUFFER
		FAB=TYP_OUTFAB		; ASSOCIATED FAB
 
TYP_INPFAB::				;
	$FAB	FAC=GET,-		; FILE ACCESS IS GET(READ)
		SHR=<GET,PUT,UPI>,-	; ALLOW OTHER READERS/WRITERS
		NAM=TYP_INPNAM,-	; ADDRESS OF ASSOCIATED NAME BLOCK
		FOP=SQO,-		; SEQUENTIAL OPERATION
		DNA=DEFNAM,-		; ADDRESS OF DEFAULT NAME BUFFER
		DNS=4			; DEFAULT SIZE STARTS AT 4
 
TYP_INPNAM::				; NAME BLOCK FOR INPUT FILE
	$NAM	ESA=EXPFNM,-		; EXPANDED NAME BUFFER ADDRESS
		ESS=FILNAMSIZ,-		; MAXIMUM SIZE FOR EXPANDED NAME
		RSA=RSLFNM,-		; RESULTANT NAME
		RSS=FILNAMSIZ,-		; AND SIZE IS SAME
		RLF=TYP_AUXNAM		; LAST INPUT IS RELATED FILE
 
TYP_AUXNAM::				; AUXILLARY NAME BLOCK
	$NAM	RSA=EXPFNM,-		; RESLATED FILE NAME
		RSS=FILNAMSIZ		; SIZE OF RESULTANT NAME STRING
 
TYP_INPRAB::				;
	$RAB	RAC=SEQ,-		; SEQUENTIAL ACCESS TO FILE
		ROP=LOC,-		; LOCATE RECORDS
		UBF=LINBUF,-		; RECORD BUFFER IF NEEDED
		USZ=LINBUFSIZ,-		; MAXIMUM NUMBER OF BYTES TO MOVE
		RHB=RHBUF,-		; RECORD HEADER BUFFER
		FAB=TYP_INPFAB		; ASSOCIATED FILE ACCESS BLOCK
 
TYP_ERRRAB::				;
	$RAB	RAC=SEQ,-		; SEQUENTIAL ACCESS TO FILE
		UBF=LINBUF,-		; RECORD BUFFER IF NEEDED
		USZ=LINBUFSIZ		; MAXIMUM NUMBER OF BYTES TO MOVE
 
	.END
