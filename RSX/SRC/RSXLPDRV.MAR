	.TITLE	RSXLPDRV - VAX/VMS RSX11M AME LINE PRINTER DRIVER
	.IDENT	'V03-000'		;

;
;****************************************************************************
;*									    *
;*  COPYRIGHT (c) 1978, 1980, 1982 BY					    *
;*  DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS.		    *
;*  ALL RIGHTS RESERVED.						    *
;* 									    *
;*  THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED   *
;*  ONLY IN  ACCORDANCE WITH  THE  TERMS  OF  SUCH  LICENSE  AND WITH THE   *
;*  INCLUSION OF THE ABOVE COPYRIGHT NOTICE. THIS SOFTWARE OR  ANY  OTHER   *
;*  COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY   *
;*  OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE IS  HEREBY   *
;*  TRANSFERRED.							    *
;* 									    *
;*  THE INFORMATION IN THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT NOTICE   *
;*  AND  SHOULD  NOT  BE  CONSTRUED AS  A COMMITMENT BY DIGITAL EQUIPMENT   *
;*  CORPORATION.							    *
;* 									    *
;*  DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY OF ITS   *
;*  SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.		    *
;* 									    *
;*									    *
;****************************************************************************

;++
; FACILITY:
;
;	VAX/VMS RSX11M AME
;
; ABSTRACT:
;
;	LINE PRINTER DRIVER
;
; AUTHOR: R.HEINEN 4-NOV-76
;--
;
; EXTERNAL SYMBOLS
;
	$RSXDEF			; DEFINE RSX SYMBOLS

	.SBTTL	RSX$LP_DRV - RSX11M AME LINE PRINTER DRIVER
 
;++
	.PSECT	RSXCODE,NOWRT,SHR,PIC
; RSX$LP_DRV - RSX11M AME LINE PRINTER DRIVER
;
; FUNCTIONAL DESCRIPTION:
;
; THIS ROUTINE PROCESSES I/O DIRECTED TO A LINE PRINTER
;
; INPUTS:
;
;	R2 = ADDRESS OF THE QIO CONTEXT BLOCK
;	R3 = MAJOR FUNCTION CODE
;	R5 = ADDRESS OF THE DPB AREA
;	R6 = ADDRESS OF THE IMAGE STACK
;	R8 = ADDRESS OF THE LUT
;	R10 = ADDRESS OF THE IMAGE IMPURE SECTION
;	R11 = ADDRESS OF THE IMAGE
;
; OUTPUTS:
;
;	R2,R6,R8,R10,R11 ARE PRESERVED
;--
RSX$LP_DRV::				; LINE PRINTER DRIVER
	CASE	R3,<-			;
		RSX$IOKILL,-		; I/O KILL
		LP_WLB,-		; WRITE LOGICAL BLOCK
		RSX$IEIFC,-		; READ LOGICAL BLOCK
		RSX$DLVRQIOAST,-	; ATTACH DEVICE
		RSX$DLVRQIOAST,-	; DETACH DEVICE
		RSX$IEIFC,-		; FUNCTION CODE 5
		RSX$IEIFC,-		; FUNCTION CODE 6
		RSX$IEIFC,-		; ILLEGAL
		RSX$IEIFC,-		; ILLEGAL
		RSX$DLVRQIOAST,-	; FUNCTION CODE 9
		RSX$IEIFC,-		; ILLEGAL
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$IEIFC,-		; READ VIRTUAL
		LP_WLB,-		; WRITE VIRTUAL BLOCK
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		RSX$DLVRQIOAST,-	; ACP FUNCTIONS
		>
	BRW	RSX$IEIFC		; ERROR EXIT

	.SBTTL	LP_WLB AND LP_WVB FUNCTIONS
;
; WRITE VIRTUAL BLOCK
;
LP_WVB:					; WRITE VIRTUAL BLOCK
	MOVZWL	#IO$_WRITEVBLK,I_SCRATCH+12(R10); SET FUNCTION CODE
	BRW	RSX$ISSUQIO		; PERFORM THE I/O
;
; WRITE LOGICAL BLOCK
;
LP_WLB:					; WRITE LOGICAL BLOCK
	MOVZWL	#IO$_WRITELBLK,I_SCRATCH+12(R10); SET THE FUNCTION CODE
	BRW	RSX$ISSUQIO		; PERFORM THE FUNCTION
	.END
