;
;	DCL Command Language Interpreter internal structure definitions
;
; IDENT	V03-025
;

;
;****************************************************************************
;*									    *
;*  COPYRIGHT (c) 1978, 1980, 1982 BY					    *
;*  DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASSACHUSETTS.		    *
;*  ALL RIGHTS RESERVED.						    *
;* 									    *
;*  THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED   *
;*  ONLY IN  ACCORDANCE WITH  THE  TERMS  OF  SUCH  LICENSE  AND WITH THE   *
;*  INCLUSION OF THE ABOVE COPYRIGHT NOTICE. THIS SOFTWARE OR  ANY  OTHER   *
;*  COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY   *
;*  OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF  THE  SOFTWARE IS  HEREBY   *
;*  TRANSFERRED.							    *
;* 									    *
;*  THE INFORMATION IN THIS SOFTWARE IS  SUBJECT TO CHANGE WITHOUT NOTICE   *
;*  AND  SHOULD  NOT  BE  CONSTRUED AS  A COMMITMENT BY DIGITAL EQUIPMENT   *
;*  CORPORATION.							    *
;* 									    *
;*  DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE  OR  RELIABILITY OF ITS   *
;*  SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.		    *
;* 									    *
;*									    *
;****************************************************************************
;

;++
; FACILITY:  DCL Command Language Interpreter
;
; ABSTRACT:
;
;	These are the structure definitions used by the DCL
;	command interpreter.
;
; ENVIRONMENT:
;
;	VAX/VMS operating system. supervisor mode.
;
; AUTHOR:  Tim Halvorsen, Feb 1980
;
; Modified by:
;
;	V025	PHL0045		Peter H. Lipman	15-Apr-1982
;		Add PRC_Q_SAVEPRIV
;
;	V024	PCG0008		Peter George	07-Apr-1982
;		Add SPWN_L_IMAGCNT.
;
;	V023	PCG0007		Peter George	05-Mar-1982
;		Add definitions for termination mailbox linked list.
;		Add DCL_L_VERB to CLINT own storage.  Remove DCL_B_SEEN.
;
;	V022	PCG0006		Peter George	16-Feb-1982
;		Add PRC_V_ONEXIT. Add expanded input buffer to
;		WRK for DCL$DCL_PARSE.  Remove WRK_K_PREINPLEN
;		and WRK_G_INPBUFEND (which proved to be unneeded.)
;
;	V021	PCG0005		Peter George	09-Feb-1982
;		Add WRK_K_PREINPLEN and WRK_G_INPBUFEND.
;
;	V020	PCG0004		Peter George	02-Feb-1982
;		Move WRK_L_TAB_VEC to bottom of data structure.
;
;	V019	PCG0003		Peter George 	25-Jan-1982
;		Add WRK_L_TAB_VEC.
;
;	V018	PCG0002		Peter George	13-Jan-1982
;		Add CTX_L_OUTOFBAND and SPWN_L_OUTOFBAND.
;
;	V017	TMH0017		Tim Halvorsen	02-Jan-1982
;		Replace WRK_L_PROMPTRTN with WRK_L_ERRORRTN cell.
;
;	V016	TMH0016		Tim Halvorsen	28-Dec-1981
;		Add cells to hold ASTADR, ASTPRM and EFN parameters
;		as well as flags to control copying of symbols/lognames
;		to spawn parameter block, so that the spawn supervisor
;		mode service can be used more flexibly by user-mode
;		programs.
;		Make PRC_L_SPWN be the listhead of a list of SPWN blocks
;		corresponding to all the subprocesses currently active.
;		Add a link longword to SPWN for this list.
;
;	V015	TMH0015		Tim Halvorsen	22-Dec-1981
;		Add verification flag to spawn context record.
;		Move autologout flag to header record from cmdstr record.
;		Add base priority longword to spawn parameter block.
;		Add address of "current" SPWN block to PRC storage
;		in order for the subprocess termination AST to access it.
;		Add EOF silent logout flag to PRC, CTX and SPWN blocks.
;
;	V014	TMH0014		Tim Halvorsen	22-Dec-1981
;		Add STATUS field to SPWN block and remove INPUT flag.
;
;	V013	TMH0013		Tim Halvorsen	30-Nov-1981
;		Add listhead for F$SEARCH context blocks into
;		indirect frame block.
;
;	V012	TMH0012		Tim Halvorsen	17-Nov-1981
;		Create this file from all the structures in CLIDEF.MDL
;		which are specific to DCL only, and do not necessarily
;		have to be the same as the MCR structures.  The definition
;		of the command tables format (only) is left in CLIDEF.MDL.
;		Remove MCR specific structures, such as BLK, SUB & MCR.
;		Add cell to PRC to hold current out-of-band enable bitmask
;		and remove now obsolete NOCTLY flag.
;
;	V011	TMH0011		Tim Halvorsen	08-Nov-1981
;		Add bit indicating if terminal is detached or not.
;		Add bit indicating that implied automatic logout should
;		occur when we next attempt to read a command line from
;		the input stream (for SPAWN command).
;		Add word to contain channel to re-attach mailbox.
;		Remove obsolete USRDET and GOEOF flags from PRC area.
;		Add SPWN and CTX structures for SPAWN/ATTACH commands.
;
;	V010	PCG0001		Peter George	29-Oct-1981
;		Add DCL and MCR data structures.
;
;	V009	BLS0089		Benn Schreiber	15-Oct-1981
;		Add cli field and spares to vec.  tables level is now 4
;		Add mcrparse flag to cmd flags
;
;	V008	TMH0008		Tim Halvorsen	31-Aug-1981
;		Add cells for SPAWN and ATTACH commands.
;
;	V007	TMH0007		Tim Halvorsen	25-Aug-1981
;		Add ENT$C_RESTOFLINE as value type which indicates that
;		the rest of the line should be gobbled as the value.
;		Add cell to hold the qualifier number which caused the
;		first command syntax transition.  This is for the GETOPT
;		callback used by the SET and SHOW commands for compatibility.
;		Re-number the value type codes to start at 1, rather than 0,
;		so that zero can be used as the default (STRING).
;
;	V006	TMH0006		Tim Halvorsen	13-Jun-1981
;		Document format of symbol table values
;
;	V005	TMH0005		Tim Halvorsen	27-Apr-1981
;		Add PRC_L_INDCLOCK, and change meaning of PRC_L_INDEPTH.
;		Remove obsolete QUA and PRM structures.
;		Remove PRC_L_CLIWRK0-3, and add PRC_L_PPFLIST.
;		Increase size of NAM block to account for new extensions.
;
;	V004	TMH0004		Tim Halvorsen	26-Mar-1981
;		Add PRD_T_OUTDVI field for batch job login initialization.
;
;	V003	TMH0003		Tim Halvorsen	11-Feb-1981
;		Add flag to mark that we are within the comment
;		string during symbol substitution, to avoid issuing
;		error messages during substitution in comments.
;		Add 3 cells to WRK to support caller callback entry
;		points during parsing.  Add pointer into expansion
;		buffer (rather than R9).  Add pointer into expansion
;		buffer which points to the current token being parsed
;		for error reporting (rather than R6).
;		Remove unused cells CMDOUT, IOSB and flag IMCHNG.
;		Rename SYM_B_NESTLEVEL to SYM_B_UNIQUEPT
;		Add UIC to list of value types.
;
;	V002	TMH0002		Tim Halvorsen	03-Feb-1981
;		Add flag to mark input record substitution pass
;		and flag to prevent upcasing during GETCHAR.
;
;	V001	TMH0001		Tim Halvorsen	14-Nov-1980
;		Add symbol for length of tables vector area.
;--

;
;	DEFINE PROCESS WORK AREA (BASED AT R11=CTL$AG_CLIDATA)
;

	STRUCT	PRC
	F	SAVAP		; SAVED ARGUMENT POINTER
	F	SAVFP		; SAVED FRAME POINTER
	F	INPRAB		; ADDRESS OF INPUT RAB
	F	OUTRAB		; ADDRESS OF OUTPUT RAB
	F	ERRRAB		; ADDRESS OF ERROR RAB
	F	INDINPRAB	; ADDRESS OF INDIRECT INPUT RAB
	F	INDOUTRAB	; ADDRESS OF INDIRECT OUTPUT RAB
	F	INDFAB		; ADDRESS OF INDIRECT FAB
	F	ALLOCREG,Q	; SYMBOL ALLOCATION REGION LISTHEAD
	F	GLOBAL,Q	; GLOBAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	SEVERITY	; ADDRESS OF ERROR SEVERITY SYMBOL VALUE
	F	STATUS		; ADDRESS OF COMPLETION STATUS VALUE
	F	INDEPTH		; INDIRECT STACK DEPTH (# LEVELS DEEP)
	F	SYMBOL		; ADDRESS OF GOTO LABEL TABLE ENTRY
	F	INPCHAN,W	; INPUT CHANNEL FOR INTERACTIVE JOBS
	F	ERRIFI,W	; SYS$ERROR RMS IFI NUMBER
	F	FLAGS,W		; PROCESS LEVEL FLAGS
	V	<M
		,1
		CNTRLY		; SUPERVISOR CONTROL Y/C LEVEL REQUEST
		DISABL		; DISABLE CONTROL Y AST'S
		EXIT		; EXIT HANDLER ESTABLISHED
		GOTO		; FORWARD GOTO IN PROGRESS
		IND		; PROCESSING INDIRECT FILE
		MODE		; COMMAND PROCESSING MODE (BATCH=1, INTER=0)
		VERIFY		; VERIFY LINES OF INDIRECT COMMAND FILES
		AUTOLOGO	; SILENT LOGOUT ($DELPRC) ON NEXT LEVEL 0 $GET
		DBGQUAL		; DEBUG QUALIFIER SEEN ON COMMAND
		DBGTRUE		; STATE OF DEBUG WAS TRUE
		YLEVEL		; RUNNING AT CONTROL Y LEVEL
		HANGUP		; TERMINAL HANGUP PENDING
		PAUSE		; CLI PAUSE STATE ACTIVE
		EOFLOGO		; SILENT LOGOUT ($DELPRC) ON LEVEL 0 EOF
		DETACHED	; TERMINAL IS DETACHED FROM THIS PROCESS
		>
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON CONDITION COMMAND TEXT
	F	PPFLIST		; LISTHEAD OF OPEN PPF RAB'S (VIA OPEN COMMAND)
	F	TMBX,L		; LISTHEAD OF TERMINATION MAILBOX STORAGE
				; BLOCKS; FOR EACH TERMINATION MAILBOX CREATED
	F	,B,2
	F	ATTMBX,W	; CHANNEL TO MAILBOX FOR RE-ATTACH REQUESTS
	F	INDCLOCK	; TOTAL INDIRECT STACKS & UNSTACKS
	F	TAB_VEC		; ADDRESS OF COMMAND TABLE VECTOR
	F	EXTBLK		; EXIT HANDLER CONTROL BLOCK
	F	EXTHND		; EXIT HANDLER ADDRESS
	F	EXTARG		; NUMBER OF EXIT HANDLER ARGUMENTS
	F	EXTPRM		; ADDRESS OF REASON FOR EXIT (BELOW)
	F	EXTCOD		; REASON FOR EXIT
	F	STACKPT		; INDIRECT STACK POINTER
	F	STACKLM		; INDIRECT STACK LIMIT
	F	EXMDEPADR	; "DOT" FOR EXAMINE/DEPOSIT
	F	EXMDEPWID,B	; WIDTH DEFAULT, IE: BYTE,WORD,LONGWORD
	F	EXMDEPMOD,B	; MODE DEFAULT, IE: ASCII,HEX,OCTAL
	F	DEFRADIX,B	; CURRENT DEFAULT RADIX
	C	<,_K_		; PROCESS RADIX TYPES
		HEX		; HEXIDECIMAL
		DEC		; DECIMAL
		OCT		; OCTAL
		>
	F	FLAGS2,B	; PROCESS LEVEL FLAGS (MORE OF THEM)
	V	<M
		CMD		; COMMAND CALLBACK HAS BEEN DONE
		CHAIN		; CHAIN CALLBACK HAS BEEN DONE
		RUNDEF		; USE RUN DEFAULT (NOT EXTERNAL)
		EXEONLY		; IMAGE IS EXECUTE ONLY
		PRIV		; IMAGE IS PRIVILEGED
		ONEXIT		; EXIT ALREADY PERFORMED
		>
	F	LSTSTATUS	; LAST STATUS SET (LONGWORD VALUE)
	F	OUTOFBAND	; OUT OF BAND AST ENABLE BITMASK
	V	<M
		,20		; SKIP UNUSED CHARACTERS
		CTRLT		; CONTROL T
		,4		; SKIP UNUSED CHARACTERS
		CTRLY		; CONTROL Y
		>
	F	ONCTLY		; ADDRESS OF ON CONTROL/Y COMMAND TEXT
	F	IDFLNK		; POINTER TO INDIRECT FILE FRAMES
	F	SPWN		; LISTHEAD OF SPAWN STORAGE BLOCKS FOR EACH
				; SUBPROCESS CREATED; SPAWN STORAGE FOR PROCESS
				; CURRENTLY BEING SPAWNED IS FIRST, IF ANY.
	F	,L,3
	F	IMAGENAME,Q	; DESCRIPTOR OF CHAIN IMAGE FILE SPECIFICATION
	F	COMMAND,Q	; DESCRIPTOR OF CHAIN COMMAND LINE FOR LATER
	F	SAVEPRIV,Q	; SAVED PRIVILEGED IMAGE PRIVILEGES
	L	LENGTH		; LENGTH OF PROCESS WORK AREA
	E

;
;	DEFINE PROCESS RMS DATA AREA
;

	STRUCT	PRD
	F	FAB,G,80		; PROCESS FAB
	F	NAM,G,96		; PROCESS NAME BLOCK
	F	INPRAB,G,68		; INPUT RAB
	F	ALTINPRAB,G,68		; ALTERNATE INPUT RAB
	F	ALTOUTRAB,G,68		; ALTERNATE OUTPUT RAB
	F	OUTRAB,G,68		; OUTPUT RAB
	L	LENGTH			; NORMAL LENGTH
; FOLLOWING EXTENSION USED ON LEVEL 0 TO STORE FID/DID/FNM FOR QUEUING
; THE JOB LOG FILE TO THE JOB CONTROLLER.
	F	OUTDVI,T,16		; DEVICE FOR OUTPUT FILE
	F	OUTFID,W,3		; FILE ID FOR OUTPUT FILE
	F	OUTDID,W,3		; DIRECTORY ID FOR OUTPUT FILE
	F	OUTFNM,T,20		; OUTPUT FILE NAME
	L	XLENGTH			; LENGTH OF EXTENDED BLOCK
	E

;
;	DEFINE COMMAND WORK AREA (BASED AT R10)
;

	STRUCT	WRK
	C	<
		DCLBUFSIZ,508	; DCL_PARSE INPUT BUFFER SIZE IN BYTES
		CMDBUFSIZ,508	; EXPANDED COMMAND BUFFER SIZE IN BYTES
		INPBUFSIZ,132	; INPUT BUFFER SIZE IN BYTES
		MSGBUFSIZ,132	; OUTPUT MESSAGE BUFFER SIZE IN BYTES
		RSLBUFSIZ,96*4	; RESULT PARSE BUFFER SIZE IN BYTES (96 MAX)
		>
	-F	,B,0		; ENDING ADDRESS OF NEGATED STRUCTURE
				; (NEEDED TO OBTAIN LENGTH DEFINITION)
	L	LENGTH		; LENGTH OF COMMAND PARSING WORK AREA
	-F	,B,4		; 4 BYTES BEFORE INPUT BUFFER FOR SLOPUNDER
	-F	DCLPRSBUF,G,508	; INPUT BUFFER FOR DCL_PARSE
	-F	,L		; SPARE LONGWORD
	-F	TAB_VEC		; ADDRESS OF COMMAND TABLE VECTOR
	-F	MARKPTR		; POINTER INTO EXPANSION BUFFER OF THE CURRENT
				; SEGMENT BEING PARSED
	-F	EXPANDPTR	; EXPANSION BUFFER CHARACTER POINTER
	-F	RESULT,G,380	; RESULT PARSE DESCRIPTOR AREA (96 MAX)
	-F	RSLEND,L	; ADDRESS OF LAST TOKEN DESCRIPTOR
	-F	RSLNXT,L	; ADDRESS OF NEXT FREE TOKEN DESCRIPTOR
	-F	BUFFER,G,508	; COMMAND EXPANSION BUFFER
	S	RECORD,255,G	; INPUT RECORD BUFFER FOR FILE I/O COMMANDS
	-F	,B,4		; 4 BYTES BEFORE INPUT BUFFER FOR SLOPUNDER
	-F	INPBUF,G,132	; COMMAND INPUT BUFFER FOLLOWS EXPANSION BUFFER
	-F	SPECRTN		; ADDRESS OF SPECIAL CHARACTER PROCESSING RTN
	-F	VERBTYP,B	; COMMAND VERB TYPE (SEE $CLIVERBDEF)
	-F	CMDOPT,B	; QUALIFIER # CAUSING THE FIRST SYNTAX CHANGE
	-F	,B,2		; LONGWORD ALIGNMENT
	-F	SAVSP		; SAVED STACK POINTER
	-F	SAVAP		; SAVED ARGUMENT POINTER
	-F	SAVFP		; SAVED INITIAL FRAME POINTER
	-F	PROMPT		; ADDRESS OF CURRENT PROMPT STRING
	-F	ERRORRTN	; ADDRESS OF CHARACTER INPUT ERROR ROUTINE
	-F	READRTN		; ADDRESS OF CONTINUATION INPUT ROUTINE
	-F	PROPTR		; ADDRESS OF PROMPT DESCRIPTORS
	-F	QUABLK		; ADDRESS OF QUALIFIER DESCRIPTORS
	-F	MAXPARM		; MAXIMUM NUMBER OF PARAMETERS ALLOWED
	-F	MINPARM		; MINIMUM NUMBER OF PARAMETERS REQUIRED
	-F	IMAGE		; ADDRESS OF IMAGE NAME STRING; OR TABLE INDEX
	-F	PARMCNT		; CURRENT PARAMETER COUNT
	-F	PAROUT		; ADDRESS OF LISTS OF OUTPUTS
	-F	IMGCHAN,W	; IMAGE ACTIVATION CHANNEL NUMBER
	-F	FLAGS,W		; COMMAND LEVEL FLAGS
	V	<M
		RUNDWN		; RUNDOWN HAS BEEN DONE
		COMMAND		; COMMAND (IMAGE) EXECUTION IN PROGRESS
				; (SO, AVOID PRINTING ERROR SEGMENT TEXT)
		PROMPT		; PROMPTING IN PROGRESS
		QUAL		; PROCESSING QUALIFIER
		QUOTE		; PROCESSING QUOTED STRING
		STAR		; ASTERISK IS TERMINATOR
		VERB		; PROCESSING VERB
		INQUIRE		; INQUIRE COMMAND - READ REQUIRED
		NOSTAT		; DON'T STORE SUCCESS STATUS ON COMPLETION
		TRAILSPC	; TRAILING SPACES IN CONTINUED LINE
		INPSUBST	; CURRENTLY SUBSTITUTING INPUT RECORD SYMBOLS
		NOUPCASE	; DON'T UPCASE CHARACTERS FROM INPUT BUFFER
		COMMENT		; WE ARE WITHIN A COMMENT DURING "INPSUBST"
				; (SO, SUPPRESS ANY ERRORS DURING SUBSTITUTION)
		>
	-F	CHARPTR		; INPUT BUFFER CHARACTER POINTER
	E

;
;	DEFINE RESULT PARSE POINTERS.  EACH POINTER DESCRIBES
;	A TOKEN ON THE COMMAND LINE FROM LEFT TO RIGHT.
;

	STRUCT	PTR
	F	DESCR,L		; EACH POINTER IS 1 LONGWORD
	S	VALUE,0,B	; LOW BYTE IS VALUE (QUALIFIER #, ETC)
	V	<
		VALUE,8		; ITEM VALUE
		OFFSET,12	; ITEM OFFSET IN BUFFER
		FLAGS,4		; ITEM FLAGS
		TERM,4		; ITEM TERMINATOR CLASS NUMBER
		TYPE,4		; ITEM TYPE
		>
	V	<		; FLAG BIT DEFINITIONS
		,20
		NEGATE		; QUALIFIER WAS NEGATED
		>
	C	<,_K_,1		; DEFINE TERMINATOR CLASSES, STARTING AT 1
		BLANK		; BLANK
		COLON		; COLON
		SLASH		; SLASH
		PLUS		; PLUS SIGN
		COMMA		; COMMA
		RPAREN		; RIGHT PARENTHESIS
		LPAREN		; LEFT PARENTHESIS
		>
	C	<,_K_,0		; DEFINE TYPE NUMBERS, STARTING AT 0
		COMDQUAL	; COMMAND QUALIFIER
		PARMQUAL	; PARAMETER QUALIFIER
		QUALVALU	; QUALIFIER VALUE
		PARAMETR	; PARAMETER
		ENDLINE		; END OF LINE
		>
	L	LENGTH		; FIXED LENGTH OF DESCRIPTOR
	E

;
;	DEFINE PARAMETER LIST MARKER.  EACH MARKER DESCRIBES
;	THE STARTING THRU ENDING POINTERS WHICH DESCRIBE A
;	GIVEN PARAMETER (INCLUDING QUALIFIERS AND VALUES).
;

	STRUCT	PLM
	F	NXTDESC,B	; NEXT DESCRIPTOR TO BE EXAMINED IN CURRENT LIST
	F	FSTDESC,B	; FIRST DESCRIPTOR IN LIST
	F	LSTDESC,B	; LAST DESCRIPTOR IN LIST
	F	TRMDESC,B	; TERMINATOR DESCRIPTOR
	L	SIZE		; SIZE OF EACH ENTRY
	E

;
;	DEFINE STORAGE USED BY OLD CLI INTERFACE.
;
;	THE MEMORY FOR THIS AREA IS SUPPLIED BY THE CALLING PROGRAM.
;

	STRUCT	RPW		; RESULT PARSE WORK AREA
	F	USERCTX		; USER CONTEXT LONGWORD
	F	DCLWRK		; ADDRESS OF COMMAND WORK AREA
	F	STRPARM,B	; INDEX TO FIRST PARAMETER DESCRIPTOR
	F	LSTDESC,B	; INDEX TO LAST PARAMETER DESCRIPTOR
	F	,B,2		; SPARE
	F	,L,5		; SPARE
	F	BITS,G,32	; 256 BITS, 1 IF PLM PROCESSED BY RESULT PARSE
	L	HDRSIZ		; SIZE OF FIXED PORTION
	F	PRMLIM,G,64	; UP TO 16 PARAMETER LIMIT DESCRIPTORS (PLM)
	L	LENGTH		; LENGTH OF MAXIMUM SIZE
	E

;
;	DEFINE STORAGE USED BY NEW CLI INTERFACE
;

	STRUCT	DCL
	F	PRMLIM,L,16		; Parameter limit descriptors
	F	ENTITY			; Last entity processed (block address)
	F	TOKEN			; Last value token returned
	F	VERB			; The four character verb string
	F	PARAM,B			; Last parameter # requested
	F	FLAGS,B			; Flags byte
	V	<
		NOWRKAREA		; True if invalid WRK area pointer
		>
	L	SIZE
	E

;
;	DEFINE SYMBOL TABLE ENTRY
;

	STRUCT	SYM
	F	FL		; SYMBOL ENTRY FORWARD LINK
	F	BL		; SYMBOL ENTRY BACKWARD LINK
	F	SIZE,W		; SIZE OF SYMBOL TABLE ENTRY
	F	TYPE,B		; TYPE OF SYMBOL
	C	<,_K_
		STRING		; VALUE IS VARIABLE LENGTH STRING
		PERM		; PERMANENT SYMBOL, STRING
		BINARY		; VALUE IS BINARY LONGWORD VALUE
		LABEL		; VALUE IS RFA OF LINE WITH LABEL
		>
	F	NONUNIQUE,B	; LENGTH OF NAME PORTION WHICH IS NONUNIQUE
				; (THAT IS, # CHARS AFTER UNIQUENESS POINT)
	F	SYMBOL,T	; ASCIC SYMBOL NAME
				; SYMBOL VALUE DIRECTLY FOLLOWS:
				;   FOR STRING: WORD-COUNTED STRING
				;   FOR BINARY: LONGWORD
				;   FOR LABELS: WORD OF 6, FOLLOWED BY 6 BYTE RFA
	E

;
;	DEFINE INDIRECT STACK FRAME
;

	STRUCT	IDF
	F	LNK		; POINTER TO NEXT INDIRECT FILE FRAME
	F	INPIFI,W	; IFI FOR INPUT
	F	OUTIFI,W	; IFI FOR OUTPUT
	F	OUTISI,W	; ISI FOR OUTPUT
	F	ONLEVEL,W	; ON ERROR LEVEL NUMBER
	F	ONERROR		; ADDRESS OF ON ERROR COMMAND TEXT
	F	INPRABCTX	; CONTENTS OF INPUT RAB CTX LONGWORD
	F	OUTRABCTX	; CONTENTS OF OUTPUT RAB CTX LONGWORD
	F	LOCAL,Q		; LOCAL SYMBOL TABLE LISTHEAD
	F	LABEL,Q		; LABEL SYMBOL TABLE LISTHEAD
	F	OUTDVI,T,16	; INDIRECT OUTPUT DEVICE (ASCIC)
	F	INPDVI,T,16	; INDIRECT INPUT DEVICE (ASCIC)
	F	INPFID,W,3	; FILE ID FOR INPUT FILE
	F	INPDID,W,3	; DIRECTORY ID FOR INPUT FILE
	F	INPRFA,W,3	; RECORD FILE ADDRESS FOR INPUT
	F	FLAG,W		; INDIRECT FLAGS
	V	<
		INPOPN		; THIS INPUT OPEN IS REQUIRED
		>
	F	ONCTLY		; SAVED ADDRESS OF ON CONTROL/Y COMMAND
	F	SEARCHCTX	; LISTHEAD OF F$SEARCH CONTEXT BLOCKS:
				;   1ST LONGWORD = LINK POINTER, 0 TO END
				;   2ND LONGWORD = SIZE OF BLOCK IN BYTES
	F	,L
	F	,W,3
	F	,B,2
	L	LENGTH		; LENGTH OF INDIRECT FRAME
	E

;
; TEMPORARY STORAGE USED FOR SPAWNING SUBPROCESSES
;

	STRUCT	SPWN

	F	LINK,L		; POINTER TO NEXT IN CHAIN
	F	SIZE,W		; SIZE OF BLOCK
	F	,W		; UNUSED
	F	UNIT,W		; TERMINATION MAILBOX UNIT NUMBER
	F	CHAN,W		; CONTEXT MAILBOX CHANNEL
	F	FLAGS,W		; FLAGS
	V	<M
		LOG		; /LOG SPECIFIED
		PRCNAM		; /PROCESS_NAME SPECIFIED
		WAIT		; /WAIT SPECIFIED
		AUTOLOGO	; SILENT LOGOUT AFTER CMDSTR EXECUTED
		EOFLOGO		; SILENT LOGOUT AFTER INPUT FILESPEC EXECUTED
		CLISYM		; COPY CLI SYMBOLS TO SUBPROCESS
		LOGNAM		; COPY LOGICAL NAMES TO SUBPROCESS
		ACTIVE		; PROCESS CURRENTLY BEING SPAWNED
		>
	F	ACMODE,B	; ACCESS MODE TO CALL ASTADR AST ROUTINE
				; OR TO PROBE STSADR LONGWORD
	F	EFN,B		; EVENT FLAG TO SET WHEN SUBPROCESS COMPLETES
				; (-1 IF NONE)
	F	MBXNAM,Q	; DESCRIPTOR OF CONTEXT MAILBOX NAME
	F	PRCNAM,Q	; DESCRIPTOR OF PROCESS NAME
	F	INPUT,Q		; DESCRIPTOR OF SUBPROCESS INPUT FILESPEC
	F	OUTPUT,Q	; DESCRIPTOR OF SUBPROCESS OUTPUT FILESPEC
	F	CMDSTR,Q	; DESCRIPTOR OF COMMAND STRING TO BE EXECUTED
	F	IOSB,Q		; I/O STATUS BLOCK FOR QIO REQUESTS
	F	SUBPID,L	; PID OF NEWLY CREATED SUBPROCESS
	F	STATUS,L	; FINAL STATUS FROM COMPLETED SUBPROCESS
	F	PRIB,L		; BASE PRIORITY OF SUBPROCESS
	F	ASTADR,L	; AST ROUTINE TO CALL ON SUBPROCESS
				; TERMINATION (ZERO IF NONE)
	F	ASTPRM,L	; PARAMETER TO AST ROUTINE
	F	STSADR,L	; ADDRESS OF LONGWORD TO RECEIVE
				; TERMINATION STATUS (ZERO IF NONE)
	F	OUTOFBAND,L	; OUT-OF-BAND AST CHARACTER MASK
	F	IMAGCNT,L	; PROCESS IMAGE COUNT
	F	QUOTAS,G,50	; SPACE FOR SUBPROCESS QUOTA LIST
	L	LENGTH
	E

;
; FORMAT OF THE CONTEXT MESSAGES WHICH ARE TRANSMITTED FROM THE SPAWN
; COMMAND TO THE SUBPROCESS INITIALIZATION.
;

	STRUCT	CTX

	C	MAXLEN,256	; MAXIMUM RECORD SIZE

	F	TYPE,W		; MESSAGE TYPE
	C	<
		HEADER		; HEADER RECORD
		CMDSTR		; COMMAND STRING
		LOGNAM		; LOGICAL NAMES
		CLISYM		; CLI SYMBOLS
		>
	M	1

	; FOR HEADER RECORDS

	F	PROCPRIV,Q	; PROCESS PRIVILEGES
	F	OUTOFBAND,L	; OUT-OF-BAND AST CHARACTER MASK
	F	FLAGS,B		; FLAGS BYTE
	V	<M
		AUTOLOGO	; SILENT LOGOUT AFTER COMMAND STRING EXECUTED
				; (IF OFF, REVERT TO SYS$INPUT AFTER EXECUTION)
		EOFLOGO		; SILENT LOGOUT AFTER LEVEL 0 INPUT EOF
		VERIFY		; VERIFICATION FLAG
		>
	L	HDRLEN		; FIXED SIZE OF HEADER RECORD


	; FOR COMMAND STRING RECORDS

	P	1
	F	CMDSTR,T	; ASCII COMMAND STRING (NO COUNT)

	; FOR LOGICAL NAME RECORDS

	P	1
	F	ENTSIZE,W	; SIZE OF ENTRY
	F	ACMODE,B	; ACCESS MODE OF LOGICAL NAME
	F	LOGNAM,T	; ASCIC LOGICAL NAME
				; WORD-COUNTED VALUE STRING FOLLOWS

	; FOR CLI SYMBOL RECORDS

	P	1
	F	,W		; SIZE OF ENTRY
	F	SYMTAB,B	; SYMBOL TABLE TYPE
	C	<
		GLOBAL
		LOCAL
		>
	F	SYMTYPE,B	; SYMBOL TYPE
	C	<
		STRING		; VALUE IS VARIABLE LENGTH STRING
		PERM		; PERMANENT SYMBOL, STRING
		BINARY		; VALUE IS BINARY LONGWORD VALUE
		>
	F	NONUNIQUE,B	; LENGTH OF NON-UNIQUE PORTION OF NAME
				; (I.E. # CHARS AFTER UNIQUENESS POINT)
	F	SYMBOL,T	; ASCIC SYMBOL NAME
				; SYMBOL VALUE DIRECTLY FOLLOWS:
				;   FOR STRING: WORD-COUNTED STRING
				;   FOR BINARY: LONGWORD
	E


;
; TERMINATION MAILBOX LIST ITEM
;

	STRUCT	TMBX

	C	MAXREFS,4	; MAXIMUM NUMBER OF SUBPROCESSES USING A
				;   SINGLE TERMINATION MAILBOX
	F	LINK,L		; POINTER TO NEXT ITEM
	F	UNIT,W		; MAILBOX UNIT NUMBER
	F	CHANNEL,W	; MAILBOX CHANNEL NUMBER
	F	REFS,B		; NUMBER OF SUBPROCESSES CURRENTLY USING 
				;   THIS MAILBOX
	F	,B,3		; UNUSED
	F	PRC,L		; ADDRESS OF PROCESS WORK AREA
	L	LENGTH		; SIZE OF STRUCTURE
	E
